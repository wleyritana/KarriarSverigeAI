<!DOCTYPE html>
<html>
<head>
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>{{ t.app_title }}</title>
<link rel="stylesheet" href="/static/styles.css">
</head>
<body><div class="container">
<h1>{{ t.app_title }}</h1>

{% if error %}
  <div class="error-box">
    <strong>Could not extract job posting from URL.</strong>
    <div class="small">{{ error }}</div>
    <p class="small">
      Some job boards block scraping or require JavaScript rendering. Try a company careers page or an ATS-hosted posting (Greenhouse/Lever).
    </p>
  </div>

  {% if preview %}
    <details class="preview">
      <summary>Show extracted preview (debug)</summary>
      <div class="small">Status: {{ preview.status_code }} | Final URL: {{ preview.final_url }} | Extracted chars: {{ preview.text_length }}</div>
      <pre class="code">{{ preview.text[:2000] }}</pre>
    </details>
  {% endif %}

  <div class="fallback">
    <p class="small"><strong>Fallback:</strong> Paste the job description text below and run again.</p>
  </div>
{% endif %}

<form method="POST" action="/run">
<textarea name="cv" placeholder="{{ t.cv_label }}"></textarea>

<div class="job-input-mode">
  <label><strong>Job Posting Input</strong></label>
  <div class="radio-row">
    <label><input type="radio" name="job_input_mode" value="url" {% if job_input_mode!="text" %}checked{% endif %}> URL</label>
    <label><input type="radio" name="job_input_mode" value="text" {% if job_input_mode=="text" %}checked{% endif %}> Paste Text</label>
  </div>
  <div class="small">Choose one: either enter a job URL or paste the job requirements text.</div>
</div>

<div id="job_url_block">
  <input type="url" name="job_url" placeholder="{{ t.job_label }}" value="{{ job_url or '' }}">
</div>

<div id="job_text_block">
  <textarea name="job_text" placeholder="Paste job description / requirements here" rows="10">{{ job_text or '' }}</textarea>
</div>

<script>
(function() {
  const urlBlock = document.getElementById("job_url_block");
  const textBlock = document.getElementById("job_text_block");
  const urlInput = urlBlock.querySelector("input[name='job_url']");
  const textArea = textBlock.querySelector("textarea[name='job_text']");
  const radios = document.querySelectorAll("input[name='job_input_mode']");

  function sync() {
    const mode = document.querySelector("input[name='job_input_mode']:checked")?.value || "url";
    if (mode === "text") {
      textBlock.style.display = "block";
      urlBlock.style.display = "none";
      textArea.required = true;
      urlInput.required = false;
    } else {
      textBlock.style.display = "none";
      urlBlock.style.display = "block";
      urlInput.required = true;
      textArea.required = false;
    }
  }
  radios.forEach(r => r.addEventListener("change", sync));
  sync();
})();
</script>



<input name="role" placeholder="{{ t.role_label }}">
<input name="company" placeholder="{{ t.company_label }}">
<textarea name="culture" placeholder="{{ t.culture_label }}"></textarea>
<textarea name="reviews" placeholder="{{ t.reviews_label }}"></textarea>

<label>{{ t.language_label }}</label>
<select name="lang">
<option value="sv" {% if lang=="sv" %}selected{% endif %}>Svenska</option>
<option value="en" {% if lang=="en" %}selected{% endif %}>English</option>
</select>

<button type="submit">{{ t.run_analysis }}</button>
</form></div>
</body>
</html>
